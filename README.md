# 第三の衛生士 Lite

患者指導の導入・ブラシ選択と磨き具合のモニタリングを、最小の手間で体験できる完全フロントエンドのSPAです。

## 特徴

- **完全フロントエンド**: バックエンド不要、静的ホスティング可能
- **歯ブラシ選択の導入**: インタラクティブな問診で患者さんに最適な歯ブラシを推奨
- **患者モニタリング**: 磨き具合を一覧・グラフで確認、フォローが必要な方を把握
- **データ管理**: ダミーデータ生成、JSON入出力、PDF/印刷機能
- **ダーク/ライトモード**: 切り替え可能なテーマ

## 技術スタック

- **フレームワーク**: Vite + React + TypeScript
- **スタイリング**: Tailwind CSS
- **状態管理**: Zustand
- **ルーティング**: React Router
- **グラフ**: Chart.js + react-chartjs-2
- **PDF出力**: html2canvas + jsPDF
- **ストレージ**: localStorage

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで `http://localhost:5173` を開きます。

### 3. ビルド（本番用）

```bash
npm run build
```

`dist/` フォルダに静的ファイルが生成されます。これを任意の静的ホスティングサービス（Netlify、Vercel、GitHub Pagesなど）にデプロイできます。

## 使い方

### ダミーデータの生成

1. ホーム画面の「🎲 ダミーデータ生成」ボタンをクリック
2. 患者10名と過去30日分のログが自動生成されます

### 歯ブラシ選択問診

1. ホーム画面または上部メニューから「歯ブラシ選択」をクリック
2. 3〜4個の質問に答えると、推奨ブラシタイプが表示されます
3. 「印刷」または「PDF保存」で結果を保存できます

### 患者モニタリング

1. 「患者一覧」画面で全患者の達成率・連続日数などを確認
2. フィルタ（連続0日、低達成率、要フォロー）で絞り込み
3. ソート（氏名、最終ログ、達成率、連続日数、次回予約）で並び替え
4. 患者名をクリックすると詳細画面へ

### 患者詳細

- **KPIカード**: 達成日数、平均所要時間、朝晩カバー率、連続日数
- **グラフ**: 過去30日の所要時間を時系列で表示
- **症状統計**: 出血・しみる発生率
- **要フォロー**: チェックボックスでフラグ設定、メモ保存
- **PDF出力**: 詳細レポートをPDFで保存

### データの入出力

#### エクスポート
ホーム画面の「💾 データをエクスポート」ボタンでJSONファイルをダウンロード

#### インポート
1. ホーム画面の「📂 データをインポート」ボタンをクリック
2. エクスポートしたJSONファイルを選択
3. 「ほめみがき Lite」のExportBundleも読み込み可能（将来対応）

## データ構造

### ClinicBundle (JSON形式)

```typescript
{
  "version": "daisan-hygienist-lite-v1",
  "patients": [
    {
      "id": "patient-1",
      "name": "山田太郎",
      "birthday": "1980-01-01",
      "sex": "M",
      "phone": "090-1234-5678",
      "email": "example@example.com",
      "brushType": "複合植毛",
      "followUp": {
        "flag": false,
        "note": ""
      },
      "nextAppointment": "2025-11-15"
    }
  ],
  "logs": [
    {
      "id": "log-1",
      "patientId": "patient-1",
      "dateISO": "2025-10-27",
      "durationSec": 120,
      "timeOfDay": "morning",
      "selfRating": 4,
      "bleeding": false,
      "sensitivity": false,
      "source": "demo"
    }
  ],
  "messages": []
}
```

### 歯ブラシ推奨ロジック

`src/lib/rules/toothbrush_rules.json` で定義されています。編集して動作を変更できます。

- **Q1**: 歯みがき時間は3分以下ですか？
  - はい → Q2
  - いいえ → Q3
- **Q2**: むし歯傾向 vs 歯周病傾向
  - むし歯傾向 → **複合植毛**
  - 歯周病傾向 → **大型・幅広・段差植毛**
- **Q3**: 中等度以上の歯周疾患がありますか？
  - はい → **極細毛・スーパーテーパード毛**
  - いいえ → **小型・コンパクト**

## ディレクトリ構造

```
src/
├── routes/              # 画面コンポーネント
│   ├── Home.tsx        # ホーム画面
│   ├── Intake.tsx      # 歯ブラシ選択問診
│   ├── Patients.tsx    # 患者一覧
│   └── PatientDetail.tsx # 患者詳細
├── lib/                # ユーティリティ
│   ├── store.ts        # Zustand状態管理
│   ├── storage.ts      # localStorage管理
│   ├── demo.ts         # ダミーデータ生成
│   ├── metrics.ts      # 達成率・カバー率計算
│   ├── pdf.ts          # PDF生成
│   └── rules/          # 推奨ロジック
│       ├── toothbrush_rules.json
│       └── recommender.ts
├── types.ts            # TypeScript型定義
├── App.tsx             # メインコンポーネント
├── main.tsx            # エントリーポイント
└── index.css           # グローバルスタイル
```

## 既知の制限

- **完全フロントエンド処理**: すべてのデータはブラウザのlocalStorageに保存されます
- **バックアップ推奨**: 定期的にエクスポートして外部保存してください
- **ブラウザ依存**: localStorageをクリアするとデータが消えます
- **医療判断不可**: このシステムは医療判断を行うものではありません。実際の診断や治療方針は歯科医師の判断を優先してください

## 安全性・免責事項

⚠️ **重要**: このシステムは教育・デモ目的のプロトタイプです。

- 医療判断を行うものではありません
- 実際の診断や治療方針は歯科医師の判断を優先してください
- 症状がある場合は必ず歯科医院を受診してください
- データの正確性や完全性を保証するものではありません

## ライセンス

MIT License

## 開発者向け

### Lintの実行

```bash
npm run lint
```

### ビルドのプレビュー

```bash
npm run preview
```

### カスタマイズ

- **推奨ロジックの変更**: `src/lib/rules/toothbrush_rules.json` を編集
- **スタイルの調整**: Tailwind CSSクラスを編集
- **新しい画面の追加**: `src/routes/` に新しいコンポーネントを追加し、`App.tsx` でルーティング設定

---

**開発**: 第三の衛生士プロジェクト  
**バージョン**: 1.0.0  
**更新日**: 2025年10月27日
